<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JSON 데이터 표시</title>
</head>
<body>
  <button id="btn">데이터 불러오기</button>
  <div id="roomButtons"></div>
  <div id="jsonDataContainer"></div>
  
  <script>
    const btn = document.getElementById('btn');
    const roomButtonsContainer = document.getElementById('roomButtons');
    
    btn.addEventListener('click', function () {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', '/loadData', true);

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
          const data = JSON.parse(xhr.responseText);
          console.log(data)
          const jsonDataString = JSON.stringify(data, null, 2);
          console.log(jsonDataString)
          // document.getElementById('jsonDataContainer').textContent = jsonDataString;

          // room_으로 시작하는 키들에 대한 버튼 생성
          const roomKeys = Object.keys(data).filter(key => key.startsWith("room_"));
          roomButtonsContainer.innerHTML = ''; // 기존의 버튼을 초기화
          
          roomKeys.forEach(roomKey => {
            const button = document.createElement('button');
            button.textContent = roomKey;
            button.addEventListener('click', function() {
              alert(JSON.stringify(data[roomKey], null, 2));
            });
            roomButtonsContainer.appendChild(button);
          });

        } else if (xhr.readyState === 4) {
          console.error('Failed to fetch JSON data:', xhr.status);
        }
      };
      xhr.send();
    });
  </script>
</body>
</html>